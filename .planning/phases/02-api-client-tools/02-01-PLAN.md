---
phase: 02-api-client-tools
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - mcp/mrpeasy/src/services/mrpeasy/client.ts
  - mcp/mrpeasy/src/services/mrpeasy/types.ts
  - mcp/mrpeasy/src/services/mrpeasy/index.ts
autonomous: true
---

<objective>
Create MRPeasy API client with Basic Auth and typed responses.

Purpose: Foundation for all MCP tools - every tool needs this client to call the MRPeasy API.
Output: Reusable API client with authentication, error handling, and TypeScript types.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-core-infrastructure/01-SUMMARY.md

@mcp/mrpeasy/src/lib/env.ts
@mcp/mrpeasy/src/lib/logger.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MRPeasy API types</name>
  <files>mcp/mrpeasy/src/services/mrpeasy/types.ts</files>
  <action>
Define TypeScript interfaces for MRPeasy API responses:

1. Base types:
   - `MrpEasyApiResponse<T>` wrapper with data, pagination info
   - `PaginationParams` for cursor-based pagination (page, per_page)
   - `MrpEasyError` for API error responses

2. Domain types (based on MRPeasy API docs):
   - `StockItem` - inventory item with id, item_id, quantity, cost, warehouse info
   - `CustomerOrder` - order with id, number, status, customer, items, dates
   - `ManufacturingOrder` - MO with id, number, status, product, quantity, dates
   - `Product` - product with id, number, name, description, bom (bill of materials)
   - `Item` - base item for search results with id, number, name, type

Keep types minimal but accurate - don't over-engineer. Use `unknown` for nested objects we don't need yet.
  </action>
  <verify>npx tsc --noEmit passes</verify>
  <done>All domain types exported, TypeScript compiles without errors</done>
</task>

<task type="auto">
  <name>Task 2: Create MRPeasy API client</name>
  <files>mcp/mrpeasy/src/services/mrpeasy/client.ts</files>
  <action>
Create HTTP client for MRPeasy REST API:

1. MrpEasyClient class:
   - Constructor takes apiKey, apiSecret from env
   - Base URL: https://api.mrpeasy.com/rest/v1/
   - Authentication: Basic Auth (base64 encode "apiKey:apiSecret")

2. Core method `request<T>(endpoint: string, params?: Record<string, string>)`:
   - GET request with query params
   - Set Authorization header with Basic Auth
   - Set Content-Type: application/json
   - Handle response parsing
   - Throw structured errors on non-2xx

3. Domain methods (thin wrappers around request):
   - `getStockItems(params)` → GET /stock-items
   - `getCustomerOrders(params)` → GET /customer-orders
   - `getManufacturingOrders(params)` → GET /manufacturing-orders
   - `getProduct(id)` → GET /products/{id}
   - `getProducts(params)` → GET /products (for search)
   - `getItems(params)` → GET /items (for search)

4. Pagination support:
   - Accept page, per_page params
   - Return response with pagination metadata

Use native fetch (Node 18+). Do NOT use axios or node-fetch - unnecessary dependencies.
Log requests to stderr with logger module.
  </action>
  <verify>npx tsc --noEmit passes</verify>
  <done>MrpEasyClient class exports all methods, compiles without errors</done>
</task>

<task type="auto">
  <name>Task 3: Export client module with factory</name>
  <files>mcp/mrpeasy/src/services/mrpeasy/index.ts</files>
  <action>
Create module entry point:

1. Export all types from types.ts
2. Export MrpEasyClient class
3. Create factory function `createMrpEasyClient()`:
   - Gets credentials from getEnv()
   - Returns configured MrpEasyClient instance
   - Single instance pattern (memoize)

This allows tools to import from '@/services/mrpeasy' and get a pre-configured client.
  </action>
  <verify>npx tsc --noEmit passes</verify>
  <done>Module exports types, client class, and factory function</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run typecheck` passes
- [ ] All types are properly exported
- [ ] Client uses native fetch, not external HTTP library
- [ ] Basic Auth is correctly implemented (base64 encoded)
- [ ] Logger is used for request logging (stderr)
</verification>

<success_criteria>
- All tasks completed
- TypeScript compiles without errors
- API client ready for tool implementations in Wave 2
</success_criteria>

<output>
After completion, create `.planning/phases/02-api-client-tools/02-01-SUMMARY.md`
</output>
