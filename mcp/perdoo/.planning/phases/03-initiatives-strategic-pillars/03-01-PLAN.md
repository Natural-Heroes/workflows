---
phase: 03-initiatives-strategic-pillars
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/services/perdoo/operations/initiatives.ts
  - src/services/perdoo/types.ts
  - src/services/perdoo/client.ts
  - src/mcp/tools/initiatives.ts
  - src/mcp/tools/index.ts
autonomous: true

must_haves:
  truths:
    - "LLM can list initiatives with filtering by objective, lead, status, timeframe"
    - "LLM can get a single initiative by UUID with full details"
    - "LLM can create an initiative under a specific objective"
    - "LLM can update an existing initiative's properties"
    - "Initiative tools are distinct from key result tools (clean domain separation)"
    - "Instructions resource documents initiative tools and their usage"
  artifacts:
    - path: "src/services/perdoo/operations/initiatives.ts"
      provides: "INITIATIVES_QUERY using initiatives root query"
      exports: ["INITIATIVES_QUERY"]
    - path: "src/services/perdoo/types.ts"
      provides: "InitiativesData response type"
      contains: "InitiativesData"
    - path: "src/services/perdoo/client.ts"
      provides: "listInitiatives, getInitiative, createInitiative, updateInitiative methods"
      contains: "listInitiatives"
    - path: "src/mcp/tools/initiatives.ts"
      provides: "4 MCP tools: list_initiatives, get_initiative, create_initiative, update_initiative"
      exports: ["registerInitiativeTools"]
    - path: "src/mcp/tools/index.ts"
      provides: "Initiative tools registered + instructions updated"
      contains: "registerInitiativeTools"
  key_links:
    - from: "src/mcp/tools/initiatives.ts"
      to: "src/services/perdoo/client.ts"
      via: "client.listInitiatives, client.getInitiative, client.createInitiative, client.updateInitiative"
      pattern: "client\\.listInitiatives|client\\.getInitiative|client\\.createInitiative|client\\.updateInitiative"
    - from: "src/services/perdoo/client.ts"
      to: "src/services/perdoo/operations/initiatives.ts"
      via: "INITIATIVES_QUERY import"
      pattern: "import.*INITIATIVES_QUERY.*from.*operations/initiatives"
    - from: "src/services/perdoo/client.ts"
      to: "src/services/perdoo/operations/key-results.ts"
      via: "Reuses KEY_RESULT_QUERY and UPSERT_KEY_RESULT_MUTATION for get/create/update"
      pattern: "KEY_RESULT_QUERY|UPSERT_KEY_RESULT_MUTATION"
    - from: "src/mcp/tools/index.ts"
      to: "src/mcp/tools/initiatives.ts"
      via: "registerInitiativeTools import and call"
      pattern: "registerInitiativeTools"
---

<objective>
Create dedicated initiative MCP tools that wrap the existing key result infrastructure.

Purpose: Initiatives are key results with `type: "INITIATIVE"` but LLMs should interact with them as a separate domain concept. Dedicated tools with initiative-focused names and descriptions make the API natural to use without understanding the key result/initiative duality.

Output: 4 new MCP tools (list_initiatives, get_initiative, create_initiative, update_initiative) backed by the existing key result operations plus the dedicated `initiatives(...)` root query for listing.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-initiatives-strategic-pillars/03-RESEARCH.md

Key source files (proven patterns to follow):
@src/services/perdoo/operations/key-results.ts
@src/services/perdoo/types.ts
@src/services/perdoo/client.ts
@src/mcp/tools/key-results.ts
@src/mcp/tools/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initiative operations, types, and client methods</name>
  <files>
    src/services/perdoo/operations/initiatives.ts
    src/services/perdoo/types.ts
    src/services/perdoo/client.ts
  </files>
  <action>
    1. Create `src/services/perdoo/operations/initiatives.ts`:
       - Export `INITIATIVES_QUERY`: Uses the dedicated `initiatives(...)` root query (NOT `keyResults` with type filter). This query is pre-filtered server-side to return only initiatives.
       - Variables: $first: Int, $after: String, $name_Icontains: String, $objective: UUID, $lead_Id: UUID, $archived: Boolean, $status_In: String, $objectiveStage: String, $timeframe: UUID, $orderBy: String
       - Do NOT include $type variable (the initiatives root query already filters by type)
       - Return fields: id, name, description, progress, status, type, weight, startValue, targetValue, currentValue, unit, archived, startDate, dueDate, lead { id name }, objective { id name }, timeframe { id name }
       - The response field name is `initiatives` (returns keyResultConnection type)
       - Follow the exact style of KEY_RESULTS_QUERY in operations/key-results.ts (JSDoc comments, query formatting)

    2. Add to `src/services/perdoo/types.ts`:
       - Add `InitiativesData` interface: `{ initiatives: Connection<KeyResult> }` (reuses existing KeyResult type since initiatives ARE key results)
       - Place it after the KeyResultData interface, in the Key Result Types section
       - Add a JSDoc comment explaining initiatives use the same KeyResult type with type=INITIATIVE

    3. Add initiative methods to `src/services/perdoo/client.ts`:
       - Import `INITIATIVES_QUERY` from `./operations/initiatives.js`
       - Import `InitiativesData` type from `./types.js` (add to existing import)
       - Add section comment: `// Initiative Operations` (between KPI Operations and Introspection)
       - Add `listInitiatives(params?)`: Uses INITIATIVES_QUERY. Parameters: first, after, name_Icontains, objective, lead_Id, archived, status_In, objectiveStage, timeframe, orderBy. Returns InitiativesData. Default first=20.
       - Add `getInitiative(id: string)`: Reuses KEY_RESULT_QUERY (result query works for both). Returns KeyResultData.
       - Add `createInitiative(input: Omit<UpsertKeyResultInput, 'id' | 'type'>)`: Uses UPSERT_KEY_RESULT_MUTATION. Spreads input with `type: 'INITIATIVE'` added. Returns UpsertKeyResultData. Mark isMutation: true.
       - Add `updateInitiative(id: string, input: Omit<UpsertKeyResultInput, 'id'>)`: Uses UPSERT_KEY_RESULT_MUTATION. Spreads input with id added. Returns UpsertKeyResultData. Mark isMutation: true.
       - Follow same JSDoc style as existing methods (document that initiatives are key results with type=INITIATIVE under the hood)
  </action>
  <verify>
    Run `npx tsc --noEmit` from the project root. No type errors should appear for the new files and modifications.
  </verify>
  <done>
    - operations/initiatives.ts exports INITIATIVES_QUERY using the dedicated initiatives root query
    - types.ts has InitiativesData interface reusing Connection<KeyResult>
    - client.ts has 4 initiative methods (list, get, create, update) with correct typing
    - TypeScript compiles without errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Initiative MCP tools and instructions update</name>
  <files>
    src/mcp/tools/initiatives.ts
    src/mcp/tools/index.ts
  </files>
  <action>
    1. Create `src/mcp/tools/initiatives.ts`:
       - Export `registerInitiativeTools(server: McpServer, client: PerdooClient): void`
       - Import z from 'zod', McpServer type, PerdooClient type, logger, handleToolError (same imports as key-results.ts)
       - Register 4 tools:

       **list_initiatives:**
       - Description: 'List Perdoo initiatives (projects/tasks that support key results). Can filter by parent objective, lead, status, timeframe. Initiatives do NOT contribute to objective progress. Returns flattened list.'
       - Parameters: limit (int, 1-100, default 20), cursor (string, optional), objective_id (string, optional), name_contains (string, optional), lead_id (string, optional), archived (boolean, optional), status (enum NO_STATUS|OFF_TRACK|NEEDS_ATTENTION|ON_TRACK|ACCOMPLISHED, optional), timeframe_id (string, optional), order_by (string, optional)
       - Handler: calls client.listInitiatives mapping params (name_contains -> name_Icontains, objective_id -> objective, lead_id -> lead_Id, status -> status_In, timeframe_id -> timeframe, order_by -> orderBy)
       - Response: Flatten edges/node same as list_key_results. Summary text uses "initiative(s)". Response object key is `initiatives` (not keyResults).

       **get_initiative:**
       - Description: 'Get a single Perdoo initiative by UUID with full details including objective reference, progress, and status.'
       - Parameters: id (string, required)
       - Handler: calls client.getInitiative(id)
       - Response: Flatten same as get_key_result. Include all fields.

       **create_initiative:**
       - Description: 'Create a new initiative (project/task) under a Perdoo objective. Name and objective are required. Initiatives track work that supports key results but do NOT contribute to objective progress directly.'
       - Parameters: name (string, min 1), objective (string, required - parent objective UUID), description (string, optional), lead (string, optional), start_value (number, optional), target_value (number, optional), current_value (number, optional), unit (string, optional), weight (number, optional), timeframe (string, optional), additional_fields (record, optional)
       - Do NOT expose a `type` parameter (it's always INITIATIVE internally)
       - Handler: calls client.createInitiative(input) building input same pattern as create_key_result
       - Response: Same pattern as create_key_result. Response uses `keyResult` field from mutation result (the API returns keyResult even for initiatives).

       **update_initiative:**
       - Description: 'Update an existing Perdoo initiative by UUID.'
       - Parameters: id (string, required), name (string, optional), description (string, optional), lead (string, optional), start_value (number, optional), target_value (number, optional), current_value (number, optional), unit (string, optional), weight (number, optional), timeframe (string, optional), archived (boolean, optional), additional_fields (record, optional)
       - Do NOT expose a `type` parameter
       - Handler: calls client.updateInitiative(id, input) same pattern as update_key_result
       - Response: Same pattern as update_key_result.

       - End with `logger.info('Initiative tools registered');`

    2. Update `src/mcp/tools/index.ts`:
       - Add import: `import { registerInitiativeTools } from './initiatives.js';`
       - Add call after registerKpiTools: `registerInitiativeTools(server, client);`
       - Update INSTRUCTIONS_RESOURCE to add Initiatives section after Key Results section:
         ```
         ### Initiatives
         - **list_initiatives**: List initiatives with pagination and filters. Supports `limit`, `cursor`, `name_contains`, `objective_id`, `lead_id`, `archived`, `status`, `timeframe_id`, `order_by`.
         - **get_initiative**: Get a single initiative by UUID with full details including objective reference and progress.
         - **create_initiative**: Create a new initiative. `name` and `objective` (parent objective UUID) are required. Provide `start_value`, `target_value`, `current_value`, `unit`, `lead`, or `additional_fields`.
         - **update_initiative**: Update an existing initiative by UUID. Provide any fields to change (`name`, `current_value`, `target_value`, `lead`, `archived`, etc.).
         ```
       - Add to Key Concepts section (after Key Result Type):
         ```
         ### Initiative vs Key Result
         - **Initiatives** are projects or tasks that support key results
         - Initiatives do NOT contribute to objective progress (only key results do)
         - Initiatives can track progress via Binary, Milestone, or metric values
         - Use `list_initiatives` (not `list_key_results` with type filter) for cleaner results
         ```
       - Add to Filtering section:
         ```
         ### list_initiatives filters:
         - `name_contains`: Case-insensitive name search
         - `objective_id`: Filter by parent objective UUID
         - `lead_id`: Filter by lead user UUID
         - `archived`: Filter by archived status
         - `status`: Filter by commit status
         - `timeframe_id`: Filter by timeframe UUID
         ```
       - Update Entity Relationships to add:
         - **Initiatives** belong to an **Objective** (parent, required for creation)
         - **Initiatives** do NOT contribute to objective progress
       - Update Mutations section to add:
         - **create_initiative** / **update_initiative**: Uses `upsertKeyResult` mutation with type set to INITIATIVE
       - Update SERVER_DESCRIPTION to mention initiatives: 'Perdoo OKR integration. Manage objectives, key results, initiatives, KPIs, and strategic pillars.'
  </action>
  <verify>
    Run `npx tsc --noEmit` from the project root. Then run `npm run build` to confirm the full build succeeds. Verify the built output includes the new tools file.
  </verify>
  <done>
    - tools/initiatives.ts exports registerInitiativeTools with 4 tools
    - tools/index.ts imports and calls registerInitiativeTools
    - INSTRUCTIONS_RESOURCE includes initiative tools documentation, filtering, concepts, and relationships
    - Full build succeeds without errors
    - All 4 initiative requirements (INIT-01 through INIT-04) are covered
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes (type safety)
2. `npm run build` succeeds (production build)
3. Grep for "registerInitiativeTools" in tools/index.ts confirms registration
4. Grep for "list_initiatives" in tools/initiatives.ts confirms tool exists
5. Grep for "INITIATIVES_QUERY" in operations/initiatives.ts confirms dedicated query
6. Grep for "type: 'INITIATIVE'" in client.ts confirms createInitiative pre-sets type
7. INSTRUCTIONS_RESOURCE contains "### Initiatives" section
</verification>

<success_criteria>
- 4 initiative MCP tools registered and functional (list, get, create, update)
- Initiatives use dedicated `initiatives(...)` root query for listing (server-side type filtering)
- Create/update internally use `upsertKeyResult` with `type: "INITIATIVE"` (no type parameter exposed to LLM)
- Get uses same `result(id: UUID!)` query as key results (shared singular query)
- Instructions resource fully documents initiative tools, filtering, and the initiative/key result distinction
- TypeScript builds without errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-initiatives-strategic-pillars/03-01-SUMMARY.md`
</output>
