---
phase: 02-api-client-tools
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - mcp/mrpeasy/src/mcp/tools/orders.ts
  - mcp/mrpeasy/src/mcp/tools/index.ts
autonomous: true
---

<objective>
Implement customer order and manufacturing order tools with Zod validation.

Purpose: Second vertical slice of MCP tools covering order management domain.
Output: Two working MCP tools: get_customer_orders, get_manufacturing_orders.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-api-client-tools/02-01-SUMMARY.md

@mcp/mrpeasy/src/mcp/tools/index.ts
@mcp/mrpeasy/src/services/mrpeasy/client.ts
@mcp/mrpeasy/src/services/mrpeasy/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create get_customer_orders tool</name>
  <files>mcp/mrpeasy/src/mcp/tools/orders.ts</files>
  <action>
Create MCP tool for fetching customer orders:

1. Define input schema with Zod:
   - status (optional enum: 'pending', 'confirmed', 'in_production', 'shipped', 'completed', 'cancelled')
   - customer_id (optional string) - filter by customer
   - date_from (optional string, ISO date) - orders after this date
   - date_to (optional string, ISO date) - orders before this date
   - page (optional number, default 1)
   - per_page (optional number, default 20, max 100)

2. Tool description:
   'Get customer orders with optional filtering by status, customer, or date range. Returns order details including items, quantities, and delivery dates.'

3. Handler:
   - Build query params from validated input
   - Call client.getCustomerOrders()
   - Format response for LLM

4. Response format:
   ```
   Customer Orders (Page X of Y):

   Order #[number] (ID: [id])
   Status: [status]
   Customer: [customer_name]
   Order Date: [date]
   Delivery Date: [delivery_date]
   Items:
     - [qty] x [item_name]
     - [qty] x [item_name]
   Total: $[total]

   ---

   [repeat for each order]

   Showing X-Y of Z orders.
   ```

Export registerOrderTools function that registers both customer and manufacturing order tools.
  </action>
  <verify>npx tsc --noEmit passes</verify>
  <done>get_customer_orders tool returns filtered, paginated order list</done>
</task>

<task type="auto">
  <name>Task 2: Create get_manufacturing_orders tool</name>
  <files>mcp/mrpeasy/src/mcp/tools/orders.ts</files>
  <action>
Add manufacturing orders tool to the orders.ts file:

1. Define input schema:
   - status (optional enum: 'pending', 'scheduled', 'in_progress', 'completed', 'cancelled')
   - product_id (optional string) - filter by product being manufactured
   - date_from (optional string, ISO date)
   - date_to (optional string, ISO date)
   - page (optional number, default 1)
   - per_page (optional number, default 20, max 100)

2. Tool description:
   'Get manufacturing orders (MOs) showing production status. Filter by status, product, or date range. Shows what is being produced, quantities, and production schedule.'

3. Handler:
   - Call client.getManufacturingOrders()
   - Format for LLM consumption

4. Response format:
   ```
   Manufacturing Orders (Page X of Y):

   MO #[number] (ID: [id])
   Status: [status]
   Product: [product_name] (ID: [product_id])
   Quantity: [qty] [unit]
   Start Date: [start_date]
   Due Date: [due_date]
   Progress: [completed_qty]/[total_qty] ([percentage]%)

   ---

   [repeat]

   Showing X-Y of Z manufacturing orders.
   ```

Both tools go in the same file since they're related (order domain).
  </action>
  <verify>npx tsc --noEmit passes</verify>
  <done>get_manufacturing_orders tool returns filtered, paginated MO list</done>
</task>

<task type="auto">
  <name>Task 3: Register order tools in MCP server</name>
  <files>mcp/mrpeasy/src/mcp/tools/index.ts</files>
  <action>
Update tools/index.ts to include order tools:

1. Import registerOrderTools from './orders.js'

2. Add to createMcpServer():
   ```typescript
   registerOrderTools(server, client);
   ```

3. Update the list in the function to show all 5 tools are now registered:
   - ping (test)
   - get_inventory
   - get_product
   - search_items
   - get_customer_orders
   - get_manufacturing_orders

Ensure proper import order and no circular dependencies.
  </action>
  <verify>npm run typecheck passes</verify>
  <done>All 5 MRPeasy tools plus ping tool registered</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run typecheck` passes
- [ ] Both tools registered: get_customer_orders, get_manufacturing_orders
- [ ] Each tool has Zod schema validation with enums for status
- [ ] Date filters work (ISO date strings)
- [ ] Response format is readable text for LLM
- [ ] Pagination params work correctly
</verification>

<success_criteria>
- All tasks completed
- TypeScript compiles without errors
- 2 new order tools available via MCP server
- Total: 6 tools registered (ping + 5 MRPeasy)
</success_criteria>

<output>
After completion, create `.planning/phases/02-api-client-tools/02-03-SUMMARY.md`
</output>
